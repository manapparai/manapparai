/*
 ThemifyGradient
 Enhanced version of ClassyGradient, with RGBA support

 Original script written by Marius Stanciu - Sergiu <marius@vox.space>
 Licensed under the MIT license https://vox.SPACE/LICENSE-MIT
 Version 1.1.1

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,g,k){a instanceof String&&(a=String(a));for(var l=a.length,m=0;m<l;m++){var y=a[m];if(g.call(k,y,m,a))return{i:m,v:y}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,k){a!=Array.prototype&&a!=Object.prototype&&(a[g]=k.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,g,k,l){if(g){k=$jscomp.global;a=a.split(".");for(l=0;l<a.length-1;l++){var m=a[l];m in k||(k[m]={});k=k[m]}a=a[a.length-1];l=k[a];g=g(l);g!=l&&null!=g&&$jscomp.defineProperty(k,a,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,k){return $jscomp.findInternal(this,a,k).v}},"es6-impl","es3");
(function(a,g,k){a.ThemifyGradient=function(l,m){var y={gradient:a.ThemifyGradient["default"],width:200,height:15,point:8,angle:180,circle:!1,type:"linear",onChange:function(){},onInit:function(){}},t=a(l),p,u,q,v,r,z,x,c=[];this.isInit=!1;this.settings={};this.__constructor=function(){this.settings=a.extend({},y,m);this.update();this.settings.onInit();this.isInit=!0;return this};this.updateSettings=function(e){this.settings=a.extend({},y,e);this.update();return this};this.update=function(){this._setupPoints();
this._setup();this._render()};this.getCSSvalue=function(){var e=this.settings.angle+"deg,";"radial"===this.settings.type&&(e=this.settings.circle?"circle,":"");for(var a=[],d=0,f=c.length;d<f;++d)a.push(c[d][1]+" "+c[d][0]);return this.settings.type+"-gradient("+e+a.join(", ")+")"};this.getString=function(){for(var e="",a=0,d=c.length;a<d;++a)e+=c[a][0]+" "+c[a][1]+"|";return e=e.substr(0,e.length-1)};this.setType=function(e){this.settings.type=e;this.settings.onChange(this.getString(),this.getCSSvalue())};
this.setAngle=function(e){this.settings.angle=e;this.settings.onChange(this.getString(),this.getCSSvalue())};this.setRadialCircle=function(e){this.settings.circle=e;this.settings.onChange(this.getString(),this.getCSSvalue())};this._setupPoints=function(){c=[];c=a.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)};this._setup=function(){var e=this,h=g.createDocumentFragment(),d=g.createDocumentFragment(),f=g.createElement("div"),b=g.createElement("div"),
w=g.createElement("span"),n=g.createElement("canvas"),m=g.createElement("span");r=g.createElement("a");q=g.createElement("div");v=g.createElement("input");p=g.createElement("div");u=g.createElement("div");f.className="themifyGradient";n.width=this.settings.width;n.height=this.settings.height;p.style.width=this.settings.width+Math.round(this.settings.point/2+1)+"px";p.className="points";q.className="point-color";w.className="gradient_delimiter";m.className="gradient_percent";m.innerHTML="%";v.type=
"text";v.className="point-position";r.className="gradient-point-delete";r.href="#";b.className="gradient-pointer-info";u.className="content";q.insertAdjacentHTML("afterbegin",'<div style="background-color: #00ff00"></div>');r.insertAdjacentHTML("afterbegin",'<i class="ti-close"></i>');b.insertAdjacentHTML("afterbegin",'<div class="gradient-pointer-arrow"></div>');d.appendChild(q);d.appendChild(w);d.appendChild(v);d.appendChild(m);d.appendChild(r);u.appendChild(d);h.appendChild(p);h.appendChild(n);
b.appendChild(u);h.appendChild(b);f.appendChild(h);for(d=w=m=h=null;l.firstChild;)l.removeChild(l.firstChild);l.appendChild(f);f=b=null;u=a(u);q=a(q);v=a(v);r=a(r);p=a(p);z=n.getContext("2d");n=a(n);n.off("click").on("click",function(a){var b=n.offset(),h="rgba(0,0,0, 1)",d=999999999999;a=a.pageX-b.left;a=Math.round(100*a/e.settings.width);for(var b=0,f=c.length;b<f;++b)c[b][0]=parseInt(c[b][0]),c[b][0]<a&&a-c[b][0]<d?(d=a-c[b][0],h=c[b][1]):c[b][0]>a&&c[b][0]-a<d&&(d=c[b][0]-a,h=c[b][1]);c.push([a+
"%",h]);c.sort(e._sortByPosition);e._render();b=0;for(f=c.length;b<f;++b)c[b][0]===a+"%"&&e._selectPoint(p.find(".point:eq("+b+")"));"visual"===k.mode&&setTimeout(e._colorPickerPosition,315)});this.pointEvents();t[0].addEventListener("keyup",function(a){var e=a.keyCode||a.which||0;8!==e&&46!==e||"INPUT"===window.top.document.activeElement.tagName||(q.siblings(".point-position").focus(),this.removePoint(a))}.bind(this),{passive:!1})};this.pointEvents=function(){for(var e=this,h=l.getElementsByClassName("point-position"),
d=function(b){var d=parseInt(a.trim(this.value));isNaN(d)?d=0:0>d?d=Math.abs(d):98<=d&&(d=98);"focusout"!==b.type?(d=Math.round(d*e.settings.width/100),a(this).closest(".themifyGradient").find(".themify_current_point").css("left",d),e._renderCanvas()):this.value=d},f=0,b=h.length;f<b;++f)h[f].addEventListener("focusout",d,{passive:!0}),h[f].addEventListener("keyup",d,{passive:!0})};this._render=function(){this._initGradientPoints();this._renderCanvas()};this._colorPickerPosition=function(){var a=
ThemifyBuilderCommon.Lightbox.$lightbox,h=u.find(".minicolors"),d=h.find(".minicolors-panel");a.offset().left+a.width()<=d.offset().left+d.width()?h.addClass("tb_minicolors_right"):h.removeClass("tb_minicolors_right")};this._initGradientPoints=function(){for(var e=this,h=g.createDocumentFragment(),d=[],f=function(){e._selectPoint(this);"visual"===k.mode&&(e._colorPickerPosition(),a(g).trigger("mouseup"))};p[0].firstChild;)p[0].removeChild(p[0].firstChild);for(var b=0,w=c.length;b<w;++b){var n=g.createElement("div");
n.className="point";n.style.backgroundColor=c[b][1];n.style.left=parseInt(c[b][0])*e.settings.width/100+"px";n.removeEventListener("click",f,{passive:!0});n.addEventListener("click",f,{passive:!0});h.appendChild(n);d[b]=n}p[0].appendChild(h);b=0;for(w=d.length;b<w;++b)a(d).draggable({axis:"x",containment:"parent",start:function(a,b){t.addClass("tb_gradient_drag").focus()},stop:function(b,e){t.removeClass("tb_gradient_drag").focus();"visual"===k.mode&&a(g).trigger("mouseup")},drag:function(a,b){e._selectPoint(this,
!0);e._renderCanvas()}});d=null};this.hexToRgb=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,e,f,b){return e+e+f+f+b+b});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};this._selectPoint=function(e,h){var d=this;x=a(e);var f=parseInt(x.css("left"));v.val(Math.round(f/this.settings.width*100));f-=30;0>f&&window.top.document.body.classList.contains("tb_module_panel_docked")&&(f=3);t.find(".gradient-pointer-info").css("marginLeft",
f+"px");if(h)return!1;t.focus();x.addClass("themify_current_point").siblings().removeClass("themify_current_point");var b=x.css("backgroundColor"),f=b.substr(4,b.length),f=f.substr(0,f.length-1);t.find(".point-color div").remove();f=q.find(".themify-color-picker");0===f.length&&(f=a('<input type="text" class="themify-color-picker" />'),f.appendTo(q).minicolors({opacity:!0,changeDelay:10,change:function(a,b){var e=d.hexToRgb(a);e||(e={r:255,g:255,b:255},b=1);x.css("backgroundColor","rgba("+e.r+","+
e.g+","+e.b+","+b+")");d._renderCanvas()}}),t.find(".minicolors").first().addClass("minicolors-focus"),r.off("click").on("click",this.removePoint.bind(this)));var b=b.replace(/^rgba?\(|\s+|\)$/g,"").split(","),c=4===b.length?b.pop():1,b=this._rgbToHex(b);f.val(b).attr("data-opacity",c).data("opacity",c).minicolors("settings",{value:b})};this._renderCanvas=function(){var a=l.getElementsByClassName("point");c=[];for(var h=0,d=a.length;h<d;++h){var f=Math.round(parseInt(a[h].style.left)/this.settings.width*
100);c.push([f+"%",a[h].style.backgroundColor])}c.sort(this._sortByPosition);this._renderToCanvas();if(this.isInit)this.settings.onChange(this.getString(),this.getCSSvalue())};this._renderToCanvas=function(){for(var a=z.createLinearGradient(0,0,this.settings.width,0),h=0,d=c.length;h<d;++h)a.addColorStop(parseInt(c[h][0])/100,c[h][1]);z.clearRect(0,0,this.settings.width,this.settings.height);z.fillStyle=a;z.fillRect(0,0,this.settings.width,this.settings.height)};this._getGradientFromString=function(a){var e=
[];a=a.split("|");for(var d=0,f=a.length;d<f;++d){var b=a[d];var c=b.indexOf("%");var g=b.substr(c-3,c);"100"===g||"100%"===g?c="100%":(c=1<c?parseInt(b.substr(c-2,c)):parseInt(b.substr(c-1,c)),c+="%");e.push([c,b.replace(c,"")])}return e};this._rgbToHex=function(a){function e(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)}var d=a[1],c=a[2];return"#"+e(a[0])+e(d)+e(c)};this._sortByPosition=function(a,
c){a=parseInt(a[0]);c=parseInt(c[0]);return a<c?-1:a>c?1:0};this.removePoint=function(a){a.preventDefault();1<c.length&&(c.splice(x.index(),1),this._render())};return this.__constructor()};a.ThemifyGradient["default"]="0% rgba(0,0,0, 1)|100% rgba(255,255,255,1)";a.fn.ThemifyGradient=function(g){return this.each(function(){void 0===a(this).data("themifyGradient")&&a(this).data("themifyGradient",new a.ThemifyGradient(this,g))})}})(jQuery,document,tb_app);
